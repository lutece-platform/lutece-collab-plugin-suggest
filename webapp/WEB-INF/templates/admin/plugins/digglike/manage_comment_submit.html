<div class="row-fluid">
	<div class="span12">
	 <div class="row-fluid">
		<div class="span3">
		<fieldset>
		<legend>#i18n{digglike.manageCommentSubmit.rowTitleDiggSubmitTitle}</legend>
		<p class="lead">
		<#if digg_submit.diggSubmitTitle?exists>
			<#if digg_submit.diggSubmitTitle?length &gt; 100>
				${digg_submit.diggSubmitTitle?substring(0,100)}... 
			<#else>
				${digg_submit.diggSubmitTitle}
			</#if>
		</#if>
		</p>
		<#if digg_submit.reported>
		<div class="alert alert-error">
			<span class="label label-important">#i18n{digglike.manageDiggSubmit.altWarning}</span>
			<span class="pull-right">
				<i id="display_advert" class="icon-chevron-down" title="Afficher les signalements"></i>
			</span>
			<div id="advert_content">
			<#if digg_submit.reportedMessages?has_content>
				<#list digg_submit.reportedMessages  as  reported_messages>
				<blockquote>
                     ${reported_messages.value}
            		<span class="pull-right">
						<small>${reported_messages.dateReported}</small>
					</span>
				</blockquote>
                </#list>
			</#if>
			</div>
		</div>
		</#if>
        <p>#i18n{digglike.manageCommentSubmit.rowDateDiggSubmit}: <strong>${digg_submit.dateResponse?date?string.short}</strong></p>
        <p>
			#i18n{digglike.manageCommentSubmit.rowStateDiggSubmit}: <#if digg_submit.diggSubmitState.number=publish_state_number>
				<span class="label label-success" title="#i18n{digglike.manageDiggSubmit.rowDiggSubmitState}"><i class="icon-white icon-ok"></i>&nbsp;#i18n{digglike.manageDiggSubmit.altPublish}</span>
			<#elseif digg_submit.diggSubmitState.number=waiting_for_publish_state_number>
				<span class="label label-warning" title="#i18n{digglike.manageDiggSubmit.rowDiggSubmitState}"><i class="icon-white icon-pause"></i>&nbsp;#i18n{digglike.manageDiggSubmit.altWaitingForPublish}</span>
			<#else>
				<span class="label label-important" title="#i18n{digglike.manageDiggSubmit.rowDiggSubmitState}"><i class="icon-white icon-remove"></i>&nbsp;#i18n{digglike.manageDiggSubmit.altDisable}</span>
			</#if></p>
     	
     	<#if digg.diggSubmitTypes?has_content && digg.diggSubmitTypes?size &gt; 0 >
     		<p>#i18n{digglike.manageCommentSubmit.rowDiggSubmitType}:
     			<#if digg_submit.diggSubmitType?has_content>
     				<strong>${digg_submit.diggSubmitType.name}</strong>
     			</#if>
     		</p>
     	</#if>
     	
     	<p>#i18n{digglike.manageCommentSubmit.rowCategory}:</p>
        <#if category_list?has_content>
			<form method="post" class="form-horizontal" action="jsp/admin/plugins/digglike/DoChangeDiggSubmitCategory.jsp">
       		<input name="id_digg_submit" value="${digg_submit.idDiggSubmit}" type="hidden">
       		<input name="comment" value="comment" type="hidden">
       		<#if digg_submit.category?exists>
				<@combo name="id_category" items=category_list default_value="${digg_submit.category.idCategory}" />
       		<#else>
				<@combo name="id_category" items=category_list default_value="-1" />
       		</#if>	
			<button type="submit" class="btn btn-primary btn-small" title="#i18n{digglike.manageDiggSubmit.buttonModify}"><i class="icon-ok icon-white"></i></button>
    		</form>
    	</#if>
		<#if !digg_submit.disableVote>
			<div class="well well-small">
				<p>	
					<i class="icon-star"></i>&nbsp;#i18n{digglike.manageDiggSubmit.rowNumberVote} : ${digg_submit.numberVote}
				</p>
				<p>
					<i class="icon-thumbs-up"></i>&nbsp;#i18n{digglike.manageDiggSubmit.rowNumberScore} : ${digg_submit.numberScore}
				</p>
			</div>
		</#if>
		<#if !digg_submit.disableComment>
			<div class="well well-small">
				<i class="icon-comment"></i>&nbsp;#i18n{digglike.manageDiggSubmit.rowNumberComment} : ${digg_submit.numberComment} 
			</p>
			<p>
				<blockquote>
				#i18n{digglike.manageDiggSubmit.rowNumberCommentEnable} : ${digg_submit.numberCommentEnable}
				<br>
				#i18n{digglike.manageDiggSubmit.rowNumberCommentIdle} : ${digg_submit.numberComment - digg_submit.numberCommentEnable}
				</blockquote>
			</p>
			</div>
		</#if>	
		<p>#i18n{digglike.manageCommentSubmit.rowManageDiggSubmit}</p>
		<p>
			<a name="${digg_submit.idDiggSubmit}"></a>	 
			<#if digg_submit.diggSubmitState.number=disable_state_number>
            <a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${waiting_for_publish_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altWaitingForPublish}">
				<i class="icon-info-sign icon-white"></i>
			</a>
			<a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${publish_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altPublish}">
				<i class="icon-ok icon-white"></i>
			</a>
			<#elseif digg_submit.diggSubmitState.number=waiting_for_publish_state_number >
			<a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${disable_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altDisable}">
				<i class="icon-remove icon-white"></i>
			</a>
			 <a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${publish_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altPublish}">
			   <i class="icon-ok icon-white"></i>
			</a>
			<#elseif digg_submit.diggSubmitState.number=publish_state_number >
            <a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${disable_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altDisable}">
				<i class="icon-remove icon-white"></i>
			</a>
			<a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/DoChangeDiggSubmitState.jsp?id_digg_submit=${digg_submit.idDiggSubmit}&state_number=${waiting_for_publish_state_number}&comment=comment#${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altWaitingForPublish}">
				<i class="icon-ok icon-white"></i>
			</a>
			</#if>	 
			<a class="btn btn-small btn-danger" href="jsp/admin/plugins/digglike/ConfirmRemoveDiggSubmit.jsp?id_digg_submit=${digg_submit.idDiggSubmit}" title="#i18n{digglike.manageDiggSubmit.altDelete}">
				<i class="icon-trash icon-white"></i>
			</a>
			<#if digg_submit_prev!=-1>
			<a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/ManageCommentSubmit.jsp?id_digg_submit=${digg_submit_prev}" title="#i18n{digglike.manageCommentSubmit.altPrevDiggSubmit}">
		  		<i class="icon-arrow-left icon-white"></i>
			</a>
			</#if>
			<#if digg_submit_next!=-1>
			<a class="btn btn-small btn-primary" href="jsp/admin/plugins/digglike/ManageCommentSubmit.jsp?id_digg_submit=${digg_submit_next}" title="#i18n{digglike.manageCommentSubmit.altNextDiggSubmit}">
				<i class="icon-arrow-right icon-white"></i>
			</a>
			</#if>
			<a class="btn btn-small" href="jsp/admin/plugins/digglike/ManageDiggSubmit.jsp?id_digg=${digg.idDigg}&comment=comment#digg${digg_submit.idDiggSubmit}" title="#i18n{portal.util.labelBack}">
				<i class="icon-remove-circle"></i>
			</a>
			</p>
		</fieldset>
    </div>
	<div class="span8">
		<fieldset>	
		<legend>#i18n{digglike.manageCommentSubmit.officialAnswer} <small>#i18n{digglike.manageCommentSubmit.labelAddOfficialAnswer}</small><legend>
			<form method="post" action="jsp/admin/plugins/digglike/DoSubmitOfficialAnswer.jsp">
				<input name="id_digg_submit" value="${digg_submit.idDiggSubmit}" type="hidden">
				<textarea name="comment_value" id="comment_value" rows="6" class="span12" <#if digg.activeEditorBbcode> class='markitup'</#if>></textarea>
				<button type="submit" class="btn btn-primary btn-small" name="add"><i class="icon-plus icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonAdd}</button>
			</form>
			</fieldset>
		<fieldset>
		<legend> #i18n{digglike.manageCommentSubmit.title}
			<form class="form-inline pull-right" action="jsp/admin/plugins/digglike/ManageCommentSubmit.jsp" method="post" name="" id="filter">
			<label>#i18n{digglike.manageCommentSubmit.labelSort}</label>
			<@combo name="id_comment_sort"  items=comment_sort_list default_value=comment_sort_selected  />
			<button class="btn btn-primary btn-small" title="#i18n{digglike.manageCommentSubmit.buttonSort}" type="submit" id="button_submit"><i class="icon-filter icon-white"></i></button>
			</form>
		</legend>
		<@paginationAdmin paginator=paginator combo=1 />
		
		<#list comment_submit_list as comment_submit>
		<div class="well">	
			<#if comment_submit.isOfficialAnswer()><span class="badge badge-info pull-right">#i18n{digglike.manageCommentSubmit.officialAnswer}</span></#if>
			<p id="comment${comment_submit.idCommentSubmit}">
				<strong>#i18n{digglike.manageCommentSubmit.rowValueCommentSubmit}
				<#if comment_submit.active>
					<span class="label label-success">#i18n{digglike.manageCommentSubmit.stateEnable}</span>
				<#else>
					<span class="label label-important" id="not_published_${comment_submit.idCommentSubmit}">#i18n{digglike.manageCommentSubmit.stateDisable}</span>
				</#if>
				</strong>
			</p>
			<pre>${digg.parseBbcodeValue(comment_submit.value)}</pre>
			<form method="post" class="form-inline pull-right" action="jsp/admin/plugins/digglike/DoChangeCommentSubmit.jsp#comment${comment_submit.idCommentSubmit}">
				<input name="id_comment_submit" value="${comment_submit.idCommentSubmit}" type="hidden">
				<#if comment_submit.active>
					<button type="submit" class="btn btn-small btn-primary" name="disable"><i class="icon-remove icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonDisable}</button>
				<#else>
					<button type="submit" class="btn btn-small btn-primary" name="enable"><i class="icon-ok icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonEnable}</button>
				</#if>          
					<button type="submit" class="btn btn-small btn-danger" name="delete"><i class="icon-trash icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonDelete}</button>
			</form>
			<p>
			<p>
			#i18n{digglike.manageCommentSubmit.rowDateCommentSubmit}: <strong>${comment_submit.dateComment}&nbsp;</strong>
			<#if comment_submit.comments?has_content>
			<span>			
			&nbsp;#i18n{digglike.manageCommentSubmit.rowLastDateCommentSubmit}: <strong>${comment_submit.dateModify}&nbsp;</strong>
			</span>
			</#if> 
			</p>
			<#if comment_submit.comments?has_content>
			<p class="comment_toggle" id="comment_toggle${comment_submit.idCommentSubmit}"><i class="icon-chevron-down"></i>&nbsp;#i18n{digglike.manageCommentSubmit.ShowSubComments}</p>
			<div class="commentComments">
				<#list comment_submit.comments as comment_comment> 
				<blockquote id="comment${comment_comment.idCommentSubmit}">
					<#if comment_comment.isOfficialAnswer()><span class="badge badge-info pull-right">#i18n{digglike.manageCommentSubmit.officialAnswer}</span></#if>
					<p>
					<strong>#i18n{digglike.manageCommentSubmit.rowValueCommentSubmit} 
					<#if comment_comment.active>
						<span class="label label-success">#i18n{digglike.manageCommentSubmit.stateEnable}</span>
					<#else>
						<span class="label label-important">#i18n{digglike.manageCommentSubmit.stateDisable}</span>
					</#if>
					</strong>
					</p>					
					<pre>${digg.parseBbcodeValue(comment_comment.value)}</pre>
					<p>#i18n{digglike.manageCommentSubmit.rowDateCommentSubmit}:  ${comment_comment.dateComment} </p> 
					<form method="post" action="jsp/admin/plugins/digglike/DoChangeCommentSubmit.jsp#comment${comment_comment.idCommentSubmit}">
					<input name="id_comment_submit" value="${comment_comment.idCommentSubmit}" type="hidden">
					<input name="id_parent" value="${comment_submit.idCommentSubmit}" type="hidden">
					<#if comment_comment.active>
						<button type="submit" class="btn btn-small btn-primary" name="disable"><i class="icon-remove icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonDisable}</button>
					<#else>
						<button type="submit" class="btn btn-small btn-primary" name="enable"><i class="icon-ok icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonEnable}</button>
					</#if>          
					<button type="submit" class="btn btn-small btn-danger" name="delete"><i class="icon-trash icon-white"></i>&nbsp;#i18n{digglike.manageCommentSubmit.buttonDelete}</button>
					</form>
				</blockquote>
				</#list>
			</div>
			</#if>
		</div>
		</#list>
		</fieldset>
		</div>
	</div>
	</div>
</div>

<#include "/util/editor/editor.html" />
<script>

$(document).ready( function () {
	var addUp = true;
	$("div.commentComments").toggle();
	doToggle( ".comment_toggle" );
	$("#advert_content").toggle();
	$("#display_advert").click( function(){ 
		$("#advert_content").toggle();
		if ( addUp ){
			$(this).addClass("icon-chevron-up");
			$(this).removeClass("icon-chevron-down");
			addUp = true;
		} else {
			$(this).removeClass("icon-chevron-up");
			$(this).addClass("icon-chevron-down");
			addUp = false;
		}
	});
	
	$(".comment_toggle").each( function(){
		var cId= $(this).attr("id");
		var n = $(this).next().find("span").hasClass("label-important");
		console.log( n  );
			if( $(this).next().find("span").hasClass("label-important") ){
				// Add all unpublished comments info 
				$(this).append(" <span class=\"badge badge-warning\"><i class=\"icon-exclamation-sign icon-white\"></i> Contient un lien non publié</span>")
			};

		}
	);
	
	<#if id_parent?has_content>
		$("#comment_toggle${id_parent}").next().toggle();
	</#if>
});

function doToggle( idParent ){
	$( idParent ).click( function(){ 
		$(this).next().toggle();
	});
	

}
</script>
<@initEditor  />